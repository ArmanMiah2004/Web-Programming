<!DOCTYPE html>
<html>
<head>
    <title>Enter PIN</title>
</head>
<body>
    <h1>EduProgress</h1>
    <div id="modeToggle">
        <button id="registerButton">Register</button>
        <button id="loginButton">Login</button>
    </div>
    <form id="pinForm" style="display: none;">
        <input type="text" id="usernameInput" placeholder="Enter username" required>
        <input type="password" id="pinInput" maxlength="4" placeholder="Enter 4-digit PIN" required>
        <input type="hidden" id="registrationMode" value="true">
        <button type="submit">Submit</button>
    </form>
    <p id="message"></p>

    <script>

        // Get form and message elements
        const pinForm = document.getElementById("pinForm");
        const usernameInput = document.getElementById("usernameInput");
        const pinInput = document.getElementById("pinInput");
        const registrationModeInput = document.getElementById("registrationMode");
        const message = document.getElementById("message");
        const registerButton = document.getElementById("registerButton");
        const loginButton = document.getElementById("loginButton");

        // Function to store user data in local storage
        function storeUserData(username, pin) {
            const userData = JSON.parse(localStorage.getItem('userData')) || {};
            userData[username] = pin;
            localStorage.setItem('userData', JSON.stringify(userData));
        }

        // Function to retrieve user data from local storage
        function retrieveUserData() {
            return JSON.parse(localStorage.getItem('userData')) || {};
        }

        // Add event listeners to toggle between registration and login modes
        registerButton.addEventListener("click", function () {
            pinForm.style.display = "block";
            registrationModeInput.value = "true";
            message.textContent = "Enter your details to register a new account.";
        });

        loginButton.addEventListener("click", function () {
            pinForm.style.display = "block";
            registrationModeInput.value = "false";
            message.textContent = "Enter your login credentials.";
        });

        // Add an event listener to the form for PIN submission
        pinForm.addEventListener("submit", function (e) {
            e.preventDefault(); // Prevent the form from submitting normally

            const username = usernameInput.value;
            const enteredPIN = pinInput.value;
            const registrationMode = registrationModeInput.value === "true";

            if (registrationMode) {
                // Registration mode: Create a new username and PIN
                const userData = retrieveUserData();

                if (userData[username]) {
                    message.textContent = "Registration Successful! You can now use your existing PIN to log in.";
                    pinInput.value = ""; // Clear the input field
                } else {
                    storeUserData(username, enteredPIN);
                    message.textContent = "Registration Successful! You can now use your new PIN to log in.";
                    pinInput.value = ""; // Clear the input field
                }
            } else {
                // Login mode: Check if the username and PIN match
                const userData = retrieveUserData();
                const storedPIN = userData[username];

                if (storedPIN == enteredPIN) { // Use loose equality comparison
                    message.textContent = "Login Successful!";
                    // Redirect to your main website page or unlock the content
                    window.location.href = "main.html"; // Replace "main.html" with your actual main page URL
                } else {
                    message.textContent = "Incorrect username or PIN. Please try again.";
                    pinInput.value = ""; // Clear the input field
                }
            }
        });
    </script>
</body>
</html>
